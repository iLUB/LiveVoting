var xlvoPlayer={init:function(c){var a=JSON.parse(c),b=new RegExp("amp;","g");a.base_url=a.base_url.replace(b,"");this.config=a;this.ready=true;xlvoPlayer.log(this.config);if(xlvoPlayer.config.use_mathjax&&!!MathJax){MathJax.Hub.Config(xlvoPlayer.mathjax_config)}},mathjax_config:{"HTML-CSS":{scale:80}},buttons_handled:false,toolbar_loaded:false,delay:1000,counter:1,timeout:null,request_pending:false,forced_update_interval:10,countdown_running:false,config:{base_url:"",voter_count_element_id:"",lng:{player_voters_online:"Online",voting_confirm_reset:"Reset?"},status_running:-1,use_mathjax:false,debug:false,ilias_51:true},player:{is_first:true,is_last:false,status:-1,active_voting_id:-1,show_results:false,frozen:true,votes:0,last_update:0,attendees:0,countdown:0,has_countdown:false},run:function(){xlvoPlayer.log("running player");this.registerElements();this.getPlayerData()},handleFullScreen:function(){this.btn_close_fullscreen.parent().hide();var c=$("div.ilTabsContentOuter");var b=c[0];var a=this;this.btn_start_fullscreen.click(function(){if(screenfull.enabled){screenfull.request(b)}});this.btn_close_fullscreen.click(function(){if(screenfull.enabled){screenfull.exit(b)}});if(screenfull.enabled){document.addEventListener(screenfull.raw.fullscreenchange,function(){if(!screenfull.isFullscreen){c.removeClass("xlvo-fullscreen");a.btn_start_fullscreen.parent().show();a.btn_close_fullscreen.parent().hide()}else{c.addClass("xlvo-fullscreen");a.btn_start_fullscreen.parent().hide();a.btn_close_fullscreen.parent().show()}})}},registerElements:function(){$(document).keydown(function(a){switch(a.which){case xlvoPlayer.config.keyboard.toggle_results:xlvoPlayer.callPlayer("toggle_results");break;case xlvoPlayer.config.keyboard.toggle_freeze:case 66:xlvoPlayer.callPlayer("toggle_freeze");break;case 33:case xlvoPlayer.config.keyboard.previous:xlvoPlayer.callPlayer("previous");break;case 34:case xlvoPlayer.config.keyboard.next:xlvoPlayer.callPlayer("next");break;default:return}a.preventDefault()});this.btn_freeze=$("#btn-freeze");this.btn_previous=$("#btn-previous");this.btn_next=$("#btn-next");this.btn_unfreeze=$("#btn-unfreeze");if(xlvoPlayer.config.ilias_51){this.btn_unfreeze.closest(".btn-group").hide()}else{this.btn_unfreeze.parent().hide()}this.btn_reset=$("#btn-reset");this.btn_terminate=$("#btn-terminate");this.btn_terminate.parent().hide();this.btn_reset.parent().attr("disabled",true);this.btn_hide_results=$("#btn-hide-results");this.btn_show_results=$("#btn-show-results");this.btn_toggle_pull=$("#btn-toggle-pull");this.btn_show_results.parent().hide();this.btn_start_fullscreen=$("#btn-start-fullscreen");this.btn_close_fullscreen=$("#btn-close-fullscreen");this.div_display_results=$("#xlvo-display-results");this.toolbar=$("nav.ilToolbar");this.toolbar.prepend('<div id="xlvo_player_loading"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');this.toolbar_loader=$("#xlvo_player_loading");this.toolbar_loader.show();this.btn_freeze.click(function(){xlvoPlayer.callPlayer("toggle_freeze");return false});this.btn_unfreeze.click(function(){xlvoPlayer.callPlayer("toggle_freeze");return false});this.btn_hide_results.click(function(){xlvoPlayer.callPlayer("toggle_results");return false});this.btn_show_results.click(function(){xlvoPlayer.callPlayer("toggle_results");return false});this.btn_reset.click(function(){if(window.confirm(xlvoPlayer.config.lng.voting_confirm_reset)){xlvoPlayer.callPlayer("reset")}return false});this.btn_next.click(function(){xlvoPlayer.callPlayer("next");return false});this.btn_previous.click(function(){xlvoPlayer.callPlayer("previous");return false});if(this.btn_toggle_pull){this.btn_toggle_pull.click(function(){xlvoPlayer.togglePull()})}this.handleFullScreen()},initElements:function(){if(this.player.frozen){this.btn_freeze.parent().hide();if(xlvoPlayer.config.ilias_51){this.btn_unfreeze.closest(".btn-group").show()}else{this.btn_unfreeze.parent().show()}if(this.player.votes>0){this.btn_reset.removeAttr("disabled")}else{this.btn_reset.attr("disabled","disabled")}}else{if(xlvoPlayer.config.ilias_51){this.btn_unfreeze.closest(".btn-group").hide()}else{this.btn_unfreeze.parent().hide()}this.btn_freeze.parent().show();this.btn_reset.attr("disabled","disabled")}if(this.player.show_results){this.btn_hide_results.parent().show();this.btn_show_results.parent().hide();this.div_display_results.show()}else{this.btn_hide_results.parent().hide();this.btn_show_results.parent().show();this.div_display_results.hide()}if(this.player.is_last){this.btn_next.attr("disabled","disabled");this.btn_previous.removeAttr("disabled")}if(this.player.is_first){this.btn_previous.attr("disabled","disabled");this.btn_next.removeAttr("disabled")}if(!this.player.is_last&&!this.player.is_first){this.btn_next.removeAttr("disabled");this.btn_previous.removeAttr("disabled")}if(this.player.is_last&&this.player.is_first){this.btn_next.attr("disabled","disabled");this.btn_previous.attr("disabled","disabled")}var a=document.getElementById("xlvo-attendees");a.innerHTML=(this.player.attendees+" Online")},startRequest:function(){xlvoPlayer.request_pending=true},endRequest:function(){xlvoPlayer.request_pending=false},isRequestPending:function(){return xlvoPlayer.request_pending},clearTimeout:function(){if(xlvoPlayer.timeout){xlvoPlayer.log("clear timeout");clearTimeout(xlvoPlayer.timeout)}},getPlayerData:function(){if(xlvoPlayer.isRequestPending()){xlvoPlayer.log("Pause getPlayerData due to running POST");return}xlvoPlayer.startRequest();$.get(xlvoPlayer.config.base_url,{cmd:"getPlayerData"}).done(function(b){xlvoPlayer.counter++;if((xlvoPlayer.counter>xlvoPlayer.forced_update_interval)||(b.player.last_update!=xlvoPlayer.player.last_update)||(b.player.show_results!=xlvoPlayer.player.show_results)||(b.player.status!=xlvoPlayer.player.status)||(b.player.active_voting_id!=xlvoPlayer.player.active_voting_id)||xlvoPlayer.player.has_countdown){var a=b.player_html;$("#xlvo-display-player").replaceWith('<div id="xlvo-display-player">'+a+"</div>");if(xlvoPlayer.config.use_mathjax&&!!MathJax){xlvoPlayer.log("kick mathjax");MathJax.Hub.Config(xlvoPlayer.mathjax_config);MathJax.Hub.Queue(["Typeset",MathJax.Hub,"xlvo-display-player"])}xlvoPlayer.counter=0;xlvoPlayer.buttons_handled=false}xlvoPlayer.player=b.player;xlvoPlayer.handleQuestionButtons(b.buttons_html);xlvoPlayer.initElements();xlvoPlayer.timeout=setTimeout(xlvoPlayer.getPlayerData,xlvoPlayer.delay);xlvoPlayer.endRequest()})},handleSwitch:function(){xlvoPlayer.buttons_handled=false;xlvoPlayer.counter=99;xlvoPlayer.endRequest()},callPlayer:function(d,b){if(xlvoPlayer.isRequestPending()){xlvoPlayer.log("There is already a request")}xlvoPlayer.startRequest();xlvoPlayer.toolbar_loader.show();var f=f?f:function(){},a=a?a:function(){},c=c?c:null;var b=b?b:{};var e=$.extend({call:d},b);$.post(xlvoPlayer.config.base_url+"&cmd=apiCall",e).done(function(g){xlvoPlayer.handleSwitch();xlvoPlayer.getPlayerData()})},callButton:function(a,b){if(xlvoPlayer.isRequestPending()){return}xlvoPlayer.startRequest();xlvoPlayer.toolbar_loader.show();this.log("call Button: "+a);$.post(xlvoPlayer.config.base_url+"&cmd=apiCall",{call:"button",button_id:a,button_data:b}).done(function(c){}).fail(function(){}).always(function(){xlvoPlayer.handleSwitch();xlvoPlayer.getPlayerData();xlvoPlayer.endRequest()})},open:function(a){this.callPlayer("open",{xvi:a});return false},updateAttendees:function(){if(xlvoPlayer.isRequestPending()){return}xlvoPlayer.startRequest();$.get(this.base_url,{cmd:"getAttendees"}).done(function(a){$("#xlvo-attendees").html(a+" Online");xlvoPlayer.timeout=setTimeout(xlvoPlayer.updateAttendees,1000);xlvoPlayer.endRequest()})},handleStartButton:function(){var a=$(".xlvo-preview");a.disableSelection();a.click(function(b){xlvoPlayer.clearTimeout();if(b.shiftKey){window.location.href=a.attr("href")+"&preview=1&key=1";return false}return true})},handleQuestionButtons:function(c){if(xlvoPlayer.buttons_handled){this.log("buttons already handled for this question");return}var e=$("<div/>").html(c).contents(),f=e.find("ul.nav"),b=f.find(".btn").length,d=this.toolbar.find("ul.nav").last(),a=d.find("li#dynamic_sep");if(b<1||!c||c===""){if(a.length>0){a.nextAll().remove();a.remove()}xlvoPlayer.log("there are no custom buttons");xlvoPlayer.log(c);xlvoPlayer.buttons_handled=true;xlvoPlayer.toolbar_loader.hide();return}xlvoPlayer.log("there are custom buttons!");f.find(".btn").each(function(){$(this).addClass("xlvo_custom_button")});if(a.length>0){xlvoPlayer.log("removing everything after separator");a.nextAll().remove()}else{xlvoPlayer.log("appending separator");d.append("<li id='dynamic_sep' class='ilToolbarSeparator hidden-xs'></li>")}d.append(f.html());d.find(".xlvo_custom_button").on("click",function(){xlvoPlayer.callButton($(this).attr("id"),true)});xlvoPlayer.toolbar_loader.hide();xlvoPlayer.buttons_handled=true},countdown:function(a){xlvoPlayer.countdown_running=true;xlvoPlayer.log("Countdown started: "+a);xlvoPlayer.callPlayer("countdown",{seconds:a})},togglePull:function(){if(xlvoPlayer.timeout){alert("Pull stopped");xlvoPlayer.clearTimeout();xlvoPlayer.timeout=false}else{alert("Pull started");xlvoPlayer.getPlayerData()}},log:function(a){if(this.config.debug){console.log(a)}},debug:function(){this.config.debug=true},stop:function(){this.config.debug=false}};